---
title: "Trait responses to global change"
format: 
  html:
    self-contained: true
editor: visual
execute:
  warnings: false
  messages: false
---

```{r}
#| label: set-up
#| echo: false
#| message: false

library(targets)
library(tarchetypes)
library(tidyverse)
library(ggplot2)
library(ggcorrplot)
library(gt)
library(gtExtras)

```


# Results

### Plant functional traits

```{r}
#| label: fig-traits
#| echo: false
#| warning: false
#| fig-height: 12
#| fig-cap: Plant community functional trait responses to warming, nitrogen addition or grazing. a) Bootstrapped trait means increasing nitrogen addition (log-transformed) under ambient (grey) and warm (pink) climate originating from alpine (triangle, solid line) and subalpine (circle, dashed line) sites. Bootstrapped trait means under b) ambient (grey) and warm climate (pink), c) grazed (blue) and ungrazed (orange) conditions, originating from subalpine and alpine sites. The points show the raw data and the lines, the predictions and confidence intervals from the model. The letters in the bottom right corner indicate significant effects of W = warming, N = nitrogen addition, G = grazing, and O = origin community, with WxO, NxO, and GxO representing their interaction. 

tar_read(trait_figure)
```


```{r}
#| label: tbl-single-traits
#| echo: false
#| tbl-cap: Model output from single trait models

tar_load(trait_anovas)

trait_anovas |> 
  group_by(Traits) |> 
  gt() |> 
  tab_spanner(
      label = md('Warming x nitrogen'),
      columns = c('Term', 'Sum of Square', 'df', 'F', 'P')
    ) |> 
  tab_spanner(
      label = md('Warming x grazing'),
      columns = c('Term_g', 'Sum of Square_g', 'df_g', 'F_g', 'P_g')
    ) |> 
  tab_style(
    style = list(
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = c('Sum of Square', df, 'F', P),
      rows = P <= 0.05)
    )|> 
  tab_style(
    style = list(
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = c('Sum of Square_g', df_g, F_g, P_g),
      rows = P_g <= 0.05)
    )|> 
  cols_label(
    Term_g = "Term",
    'Sum of Square_g' = "Sum of Square",
    df_g = "df",
    F_g = "F",
    P_g = "P"
  ) |> 
  tab_options(
  table.font.size = 12,
  data_row.padding = gt::px(1)
  )



```




### Multivariate analysis

```{r}
#| label: fig-trait_pca
#| echo: false
#| eval: false
#| fig-height: 10
#| fig-cap: Multivariate traits

#tar_read(trait_pca_figure)

```

## Supporting Information

### Trait correlations

The trait correlation is high between the size traits (area, height and dry mass).

```{r}
#| label: trait-correlation
#| echo: false
#| fig-cap: Correlations between traits.

tar_read(trait_correlation_plot)

```

### Trait coverage

The trait correlation is high between the size traits (area, height and dry mass).

```{r}
#| label: trait-n-imputation
#| echo: false
#| fig-width: 8
#| fig-cap: The proportions of the level traits were imputed for the warming x nitrogen model; plot (blue), block (green), site (orange) or global (red).

tar_read(imputation_plot_n)

```

```{r}
#| label: trait-g-imputation
#| echo: false
#| fig-cap: The proportions of the level traits were imputed for the warming x grazing model; plot (blue), block (green), site (orange) or global (red).

tar_read(imputation_plot_g)

```


### Species list

Species list at all the sites along the elevational gradient. The species are sorted by cover and functional group.

```{r}
#| label: tbl-sp-list
#| echo: false
#| tbl-cap: List of species at all three sites, sorted by cover and functional group.

tar_read(species_list_out)

```
